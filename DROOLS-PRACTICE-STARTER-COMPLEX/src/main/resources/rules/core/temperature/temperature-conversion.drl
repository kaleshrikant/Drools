package rules.core.temperature;

import com.kaleshrikant.core.temperature.model.TemperatureReading;
import com.kaleshrikant.core.temperature.model.SensorReading;

// ğŸŒ GLOBAL VARIABLES
global java.util.List logCollector;

/**
 * ğŸ“œ Temperature Monitoring and Conversion Rules - Business Logic Implementation
 *
 * ğŸ¯ Purpose: Detect temperature thresholds and convert Celsius to Fahrenheit
 * ğŸ§Š Facts: TemperatureReading object with value and unit
 * â• Conditions: Thresholds and unit checks
 * ğŸ”¥ Actions: Log alerts and perform conversions
 */

rule "High Temperature Alert"
    when
        $reading : TemperatureReading(unit == "C", value > 40)
    then
        logCollector.add("ğŸ”¥ High temperature detected: " + $reading.getValue() + "Â°C");
        $reading.setStatus("ALERT");
end

rule "Convert Celsius to Fahrenheit"
    when
        $reading : TemperatureReading(unit == "C")
    then
        double fahrenheit = ($reading.getValue() * 9/5) + 32;
        logCollector.add("ğŸŒ¡ï¸ Converted " + $reading.getValue() + "Â°C to " + fahrenheit + "Â°F");
        $reading.setConverted(fahrenheit);
end

/**
 * ğŸ“œ Extended Business Logic - Dual Sensor Validation
 *
 * ğŸ¯ Purpose: Validate readings from two sensors
 * ğŸ§Š Facts: SensorReading and TemperatureReading
 * â• Conditions: Matching timestamps and deviation check
 * ğŸ”¥ Actions: Log validation result
 */

rule "Sensor Reading Validation"
    when
        $sensor : SensorReading()
        $temp : TemperatureReading(timestamp == $sensor.timestamp, Math.abs(value - $sensor.value) < 2)
    then
        logCollector.add("âœ… Sensor and temperature readings validated at " + $sensor.getTimestamp());
        $temp.setStatus("VALIDATED");
end
